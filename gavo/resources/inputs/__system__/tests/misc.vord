<!-- a resource descriptor to more-or-less safely test a couple of operations
-->

<ResourceDescriptor srcdir="__tests">
	<schema>__tests</schema>

	<Data id="fileUploadTest" sourcePat="upload/[a-z]*">
		<KeyValueGrammar>
		</KeyValueGrammar>
		<Semantics>
			<Table table="files">
				<Field dest="name" dbtype="text" default="@srcstem" primary="True"/>
				<Field dest="a" source="a"/>
				<Field dest="b" source="b"/>
			</Table>
		</Semantics>
		<script type="postCreation" name="makeWritable">
			GRANT ALL ON __tests.files TO gavo
		</script>
	</Data>

	<Data id="boxTest" virtual="True">
		<DictlistGrammar/>
		<Semantics>
			<Table table="misctypes">
				<Field dest="box" source="box" dbtype="box"/>
			</Table>
		</Semantics>
	</Data>

	<Service id="upload">
		<meta name="title">Upload Test</meta>
		<allow renderers="upload,mupload"/>
		<meta name="shortName">fileupdate_test</meta>
		<core builtin="upload">
			<arg name="dataName" value="fileUploadTest"/>
		</core>
	</Service>

	<Service id="reset">
		<meta name="title">Reset Test Tables</meta>
		<meta name="shortName">testtables_reset</meta>
		<core builtin="runFixedQuery">
			<arg name="query">delete from __tests.files where name='c'</arg>
		</core>
	</Service>

	<Service id="timeout">
		<meta name="title">Just wait a while for a timeout</meta>
		<core builtin="runFixedQuery" timeout="1">
			<arg name="query">select (select avg(asin(sqrt(x)/224.0)) from generate_series(1, whomp) as x) as q from generate_series(1, 50000) as whomp</arg>
		</core>
	</Service>
</ResourceDescriptor>
